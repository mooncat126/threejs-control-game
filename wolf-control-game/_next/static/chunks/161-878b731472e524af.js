"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{9943:function(e,t,r){r.d(t,{z:function(){return p}});var n=r(7776),a=Object.defineProperty,o=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i=(e,t,r)=>(o(e,"symbol"!=typeof t?t+"":t,r),r);let s=new n.zHn,l=new n.JOQ,c=Math.cos(Math.PI/180*70),u=(e,t)=>(e%t+t)%t;class p extends n.pBf{constructor(e,t){super(),i(this,"object"),i(this,"domElement"),i(this,"enabled",!0),i(this,"target",new n.Pa4),i(this,"minDistance",0),i(this,"maxDistance",1/0),i(this,"minZoom",0),i(this,"maxZoom",1/0),i(this,"minPolarAngle",0),i(this,"maxPolarAngle",Math.PI),i(this,"minAzimuthAngle",-1/0),i(this,"maxAzimuthAngle",1/0),i(this,"enableDamping",!1),i(this,"dampingFactor",.05),i(this,"enableZoom",!0),i(this,"zoomSpeed",1),i(this,"enableRotate",!0),i(this,"rotateSpeed",1),i(this,"enablePan",!0),i(this,"panSpeed",1),i(this,"screenSpacePanning",!0),i(this,"keyPanSpeed",7),i(this,"zoomToCursor",!1),i(this,"autoRotate",!1),i(this,"autoRotateSpeed",2),i(this,"reverseOrbit",!1),i(this,"reverseHorizontalOrbit",!1),i(this,"reverseVerticalOrbit",!1),i(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),i(this,"mouseButtons",{LEFT:n.RsA.ROTATE,MIDDLE:n.RsA.DOLLY,RIGHT:n.RsA.PAN}),i(this,"touches",{ONE:n.QmN.ROTATE,TWO:n.QmN.DOLLY_PAN}),i(this,"target0"),i(this,"position0"),i(this,"zoom0"),i(this,"_domElementKeyEvents",null),i(this,"getPolarAngle"),i(this,"getAzimuthalAngle"),i(this,"setPolarAngle"),i(this,"setAzimuthalAngle"),i(this,"getDistance"),i(this,"listenToKeyEvents"),i(this,"stopListenToKeyEvents"),i(this,"saveState"),i(this,"reset"),i(this,"update"),i(this,"connect"),i(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>m.phi,this.getAzimuthalAngle=()=>m.theta,this.setPolarAngle=e=>{let t=u(e,2*Math.PI),n=m.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-n);2*Math.PI-a<a&&(t<n?t+=2*Math.PI:n+=2*Math.PI),g.phi=t-n,r.update()},this.setAzimuthalAngle=e=>{let t=u(e,2*Math.PI),n=m.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-n);2*Math.PI-a<a&&(t<n?t+=2*Math.PI:n+=2*Math.PI),g.theta=t-n,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",et),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",et),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(a),r.update(),d=h.NONE},this.update=(()=>{let t=new n.Pa4,o=new n.Pa4(0,1,0),i=new n._fP().setFromUnitVectors(e.up,o),u=i.clone().invert(),p=new n.Pa4,b=new n._fP,w=2*Math.PI;return function(){let I=r.object.position;i.setFromUnitVectors(e.up,o),u.copy(i).invert(),t.copy(I).sub(r.target),t.applyQuaternion(i),m.setFromVector3(t),r.autoRotate&&d===h.NONE&&R(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(m.theta+=g.theta*r.dampingFactor,m.phi+=g.phi*r.dampingFactor):(m.theta+=g.theta,m.phi+=g.phi);let E=r.minAzimuthAngle,P=r.maxAzimuthAngle;isFinite(E)&&isFinite(P)&&(E<-Math.PI?E+=w:E>Math.PI&&(E-=w),P<-Math.PI?P+=w:P>Math.PI&&(P-=w),E<=P?m.theta=Math.max(E,Math.min(P,m.theta)):m.theta=m.theta>(E+P)/2?Math.max(E,m.theta):Math.min(P,m.theta)),m.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,m.phi)),m.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(y,r.dampingFactor):r.target.add(y),r.zoomToCursor&&k||r.object.isOrthographicCamera?m.radius=V(m.radius):m.radius=V(m.radius*v),t.setFromSpherical(m),t.applyQuaternion(u),I.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(g.theta*=1-r.dampingFactor,g.phi*=1-r.dampingFactor,y.multiplyScalar(1-r.dampingFactor)):(g.set(0,0,0),y.set(0,0,0));let T=!1;if(r.zoomToCursor&&k){let a=null;if(r.object instanceof n.cPb&&r.object.isPerspectiveCamera){let e=t.length();a=V(e*v);let n=e-a;r.object.position.addScaledVector(M,n),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){let e=new n.Pa4(N.x,N.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/v)),r.object.updateProjectionMatrix(),T=!0;let o=new n.Pa4(N.x,N.y,0);o.unproject(r.object),r.object.position.sub(o).add(e),r.object.updateMatrixWorld(),a=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==a&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(a).add(r.object.position):(s.origin.copy(r.object.position),s.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(s.direction))<c?e.lookAt(r.target):(l.setFromNormalAndCoplanarPoint(r.object.up,r.target),s.intersectPlane(l,r.target))))}else r.object instanceof n.iKG&&r.object.isOrthographicCamera&&(T=1!==v)&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/v)),r.object.updateProjectionMatrix());return v=1,k=!1,!!(T||p.distanceToSquared(r.object.position)>f||8*(1-b.dot(r.object.quaternion))>f)&&(r.dispatchEvent(a),p.copy(r.object.position),b.copy(r.object.quaternion),T=!1,!0)}})(),this.connect=e=>{r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",er),r.domElement.addEventListener("pointerdown",q),r.domElement.addEventListener("pointercancel",J),r.domElement.addEventListener("wheel",ee)},this.dispose=()=>{var e,t,n,a,o,i;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",er),null==(t=r.domElement)||t.removeEventListener("pointerdown",q),null==(n=r.domElement)||n.removeEventListener("pointercancel",J),null==(a=r.domElement)||a.removeEventListener("wheel",ee),null==(o=r.domElement)||o.ownerDocument.removeEventListener("pointermove",Q),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointerup",J),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",et)};let r=this,a={type:"change"},o={type:"start"},p={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=h.NONE,f=1e-6,m=new n.$V,g=new n.$V,v=1,y=new n.Pa4,b=new n.FM8,w=new n.FM8,I=new n.FM8,E=new n.FM8,P=new n.FM8,T=new n.FM8,x=new n.FM8,A=new n.FM8,O=new n.FM8,M=new n.Pa4,N=new n.FM8,k=!1,L=[],D={};function C(){return Math.pow(.95,r.zoomSpeed)}function R(e){r.reverseOrbit||r.reverseHorizontalOrbit?g.theta+=e:g.theta-=e}function S(e){r.reverseOrbit||r.reverseVerticalOrbit?g.phi+=e:g.phi-=e}let F=(()=>{let e=new n.Pa4;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),y.add(e)}})(),j=(()=>{let e=new n.Pa4;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),y.add(e)}})(),U=(()=>{let e=new n.Pa4;return function(t,a){let o=r.domElement;if(o&&r.object instanceof n.cPb&&r.object.isPerspectiveCamera){let n=r.object.position;e.copy(n).sub(r.target);let i=e.length();F(2*t*(i*=Math.tan(r.object.fov/2*Math.PI/180))/o.clientHeight,r.object.matrix),j(2*a*i/o.clientHeight,r.object.matrix)}else o&&r.object instanceof n.iKG&&r.object.isOrthographicCamera?(F(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),j(a*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function B(e){r.object instanceof n.cPb&&r.object.isPerspectiveCamera||r.object instanceof n.iKG&&r.object.isOrthographicCamera?v/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function z(e){r.object instanceof n.cPb&&r.object.isPerspectiveCamera||r.object instanceof n.iKG&&r.object.isOrthographicCamera?v*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function G(e){if(!r.zoomToCursor||!r.domElement)return;k=!0;let t=r.domElement.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,o=t.width,i=t.height;N.x=n/o*2-1,N.y=-(a/i*2)+1,M.set(N.x,N.y,1).unproject(r.object).sub(r.object.position).normalize()}function V(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function X(e){b.set(e.clientX,e.clientY)}function _(e){E.set(e.clientX,e.clientY)}function H(){if(1==L.length)b.set(L[0].pageX,L[0].pageY);else{let e=.5*(L[0].pageX+L[1].pageX),t=.5*(L[0].pageY+L[1].pageY);b.set(e,t)}}function Y(){if(1==L.length)E.set(L[0].pageX,L[0].pageY);else{let e=.5*(L[0].pageX+L[1].pageX),t=.5*(L[0].pageY+L[1].pageY);E.set(e,t)}}function W(){let e=L[0].pageX-L[1].pageX,t=L[0].pageY-L[1].pageY;x.set(0,Math.sqrt(e*e+t*t))}function Z(e){if(1==L.length)w.set(e.pageX,e.pageY);else{let t=ea(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);w.set(r,n)}I.subVectors(w,b).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(R(2*Math.PI*I.x/t.clientHeight),S(2*Math.PI*I.y/t.clientHeight)),b.copy(w)}function K(e){if(1==L.length)P.set(e.pageX,e.pageY);else{let t=ea(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);P.set(r,n)}T.subVectors(P,E).multiplyScalar(r.panSpeed),U(T.x,T.y),E.copy(P)}function $(e){let t=ea(e),n=e.pageX-t.x,a=e.pageY-t.y;A.set(0,Math.sqrt(n*n+a*a)),O.set(0,Math.pow(A.y/x.y,r.zoomSpeed)),B(O.y),x.copy(A)}function q(e){var t,a;!1!==r.enabled&&(0===L.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",Q),null==(a=r.domElement)||a.ownerDocument.addEventListener("pointerup",J)),L.push(e),"touch"===e.pointerType?function(e){switch(en(e),L.length){case 1:switch(r.touches.ONE){case n.QmN.ROTATE:if(!1===r.enableRotate)return;H(),d=h.TOUCH_ROTATE;break;case n.QmN.PAN:if(!1===r.enablePan)return;Y(),d=h.TOUCH_PAN;break;default:d=h.NONE}break;case 2:switch(r.touches.TWO){case n.QmN.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&W(),r.enablePan&&Y(),d=h.TOUCH_DOLLY_PAN;break;case n.QmN.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&W(),r.enableRotate&&H(),d=h.TOUCH_DOLLY_ROTATE;break;default:d=h.NONE}break;default:d=h.NONE}d!==h.NONE&&r.dispatchEvent(o)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.RsA.DOLLY:if(!1===r.enableZoom)return;G(e),x.set(e.clientX,e.clientY),d=h.DOLLY;break;case n.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;_(e),d=h.PAN}else{if(!1===r.enableRotate)return;X(e),d=h.ROTATE}break;case n.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;X(e),d=h.ROTATE}else{if(!1===r.enablePan)return;_(e),d=h.PAN}break;default:d=h.NONE}d!==h.NONE&&r.dispatchEvent(o)}(e))}function Q(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(en(e),d){case h.TOUCH_ROTATE:if(!1===r.enableRotate)return;Z(e),r.update();break;case h.TOUCH_PAN:if(!1===r.enablePan)return;K(e),r.update();break;case h.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&$(e),r.enablePan&&K(e),r.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&$(e),r.enableRotate&&Z(e),r.update();break;default:d=h.NONE}}(e):function(e){if(!1!==r.enabled)switch(d){case h.ROTATE:if(!1===r.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),I.subVectors(w,b).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(R(2*Math.PI*I.x/t.clientHeight),S(2*Math.PI*I.y/t.clientHeight)),b.copy(w),r.update()}(e);break;case h.DOLLY:if(!1===r.enableZoom)return;A.set(e.clientX,e.clientY),O.subVectors(A,x),O.y>0?B(C()):O.y<0&&z(C()),x.copy(A),r.update();break;case h.PAN:if(!1===r.enablePan)return;P.set(e.clientX,e.clientY),T.subVectors(P,E).multiplyScalar(r.panSpeed),U(T.x,T.y),E.copy(P),r.update()}}(e))}function J(e){var t,n,a;(function(e){delete D[e.pointerId];for(let t=0;t<L.length;t++)if(L[t].pointerId==e.pointerId){L.splice(t,1);return}})(e),0===L.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointermove",Q),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointerup",J)),r.dispatchEvent(p),d=h.NONE}function ee(e){!1!==r.enabled&&!1!==r.enableZoom&&(d===h.NONE||d===h.ROTATE)&&(e.preventDefault(),r.dispatchEvent(o),G(e),e.deltaY<0?z(C()):e.deltaY>0&&B(C()),r.update(),r.dispatchEvent(p))}function et(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:U(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:U(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:U(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:U(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function er(e){!1!==r.enabled&&e.preventDefault()}function en(e){let t=D[e.pointerId];void 0===t&&(t=new n.FM8,D[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ea(e){return D[(e.pointerId===L[0].pointerId?L[1]:L[0]).pointerId]}void 0!==t&&this.connect(t),this.update()}}},2790:function(e,t,r){let n,a,o;r.d(t,{y:function(){return q}});var i=r(7776),s={},l=Uint8Array,c=Uint16Array,u=Uint32Array,p=new l([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new l([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),d=new l([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,t){for(var r=new c(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new u(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return[r,a]},m=f(p,2),g=m[0],v=m[1];g[28]=258,v[258]=28;for(var y=f(h,0),b=y[0],w=y[1],I=new c(32768),E=0;E<32768;++E){var P=(43690&E)>>>1|(21845&E)<<1;P=(61680&(P=(52428&P)>>>2|(13107&P)<<2))>>>4|(3855&P)<<4,I[E]=((65280&P)>>>8|(255&P)<<8)>>>1}for(var T=function(e,t,r){for(var n,a=e.length,o=0,i=new c(t);o<a;++o)++i[e[o]-1];var s=new c(t);for(o=0;o<t;++o)s[o]=s[o-1]+i[o-1]<<1;if(r){n=new c(1<<t);var l=15-t;for(o=0;o<a;++o)if(e[o])for(var u=o<<4|e[o],p=t-e[o],h=s[e[o]-1]++<<p,d=h|(1<<p)-1;h<=d;++h)n[I[h]>>>l]=u}else for(o=0,n=new c(a);o<a;++o)e[o]&&(n[o]=I[s[e[o]-1]++]>>>15-e[o]);return n},x=new l(288),E=0;E<144;++E)x[E]=8;for(var E=144;E<256;++E)x[E]=9;for(var E=256;E<280;++E)x[E]=7;for(var E=280;E<288;++E)x[E]=8;for(var A=new l(32),E=0;E<32;++E)A[E]=5;var O=T(x,9,1),M=T(A,5,1),N=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},k=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},L=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},D=function(e){return(e/8|0)+(7&e&&1)},C=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof c?c:e instanceof u?u:l)(r-t);return n.set(e.subarray(t,r)),n},R=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new l(0);var a=!t||r,o=!r||r.i;r||(r={}),t||(t=new l(3*n));var i=function(e){var r=t.length;if(e>r){var n=new l(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,c=r.p||0,u=r.b||0,f=r.l,m=r.d,v=r.m,y=r.n,w=8*n;do{if(!f){r.f=s=k(e,c,1);var I=k(e,c+1,3);if(c+=3,I){if(1==I)f=O,m=M,v=9,y=5;else if(2==I){var E=k(e,c,31)+257,P=k(e,c+10,15)+4,x=E+k(e,c+5,31)+1;c+=14;for(var A=new l(x),R=new l(19),S=0;S<P;++S)R[d[S]]=k(e,c+3*S,7);c+=3*P;for(var F=N(R),j=(1<<F)-1,U=T(R,F,1),S=0;S<x;){var B=U[k(e,c,j)];c+=15&B;var z=B>>>4;if(z<16)A[S++]=z;else{var G=0,V=0;for(16==z?(V=3+k(e,c,3),c+=2,G=A[S-1]):17==z?(V=3+k(e,c,7),c+=3):18==z&&(V=11+k(e,c,127),c+=7);V--;)A[S++]=G}}var X=A.subarray(0,E),_=A.subarray(E);v=N(X),y=N(_),f=T(X,v,1),m=T(_,y,1)}else throw"invalid block type"}else{var z=D(c)+4,H=e[z-4]|e[z-3]<<8,Y=z+H;if(Y>n){if(o)throw"unexpected EOF";break}a&&i(u+H),t.set(e.subarray(z,Y),u),r.b=u+=H,r.p=c=8*Y;continue}if(c>w){if(o)throw"unexpected EOF";break}}a&&i(u+131072);for(var W=(1<<v)-1,Z=(1<<y)-1,K=c;;K=c){var G=f[L(e,c)&W],$=G>>>4;if((c+=15&G)>w){if(o)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if($<256)t[u++]=$;else if(256==$){K=c,f=null;break}else{var q=$-254;if($>264){var S=$-257,Q=p[S];q=k(e,c,(1<<Q)-1)+g[S],c+=Q}var J=m[L(e,c)&Z],ee=J>>>4;if(!J)throw"invalid distance";c+=15&J;var _=b[ee];if(ee>3){var Q=h[ee];_+=L(e,c)&(1<<Q)-1,c+=Q}if(c>w){if(o)throw"unexpected EOF";break}a&&i(u+131072);for(var et=u+q;u<et;u+=4)t[u]=t[u-_],t[u+1]=t[u+1-_],t[u+2]=t[u+2-_],t[u+3]=t[u+3-_];u=et}}r.l=f,r.p=K,r.b=u,f&&(s=1,r.m=v,r.d=m,r.n=y)}while(!s);return u==t.length?t:C(t,0,u)},S=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},F=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},j=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,o=r.slice();if(!a)return[_,0];if(1==a){var i=new l(r[0].s+1);return i[r[0].s]=1,[i,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var s=r[0],u=r[1],p=0,h=1,d=2;for(r[0]={s:-1,f:s.f+u.f,l:s,r:u};h!=a-1;)s=r[r[p].f<r[d].f?p++:d++],u=r[p!=h&&r[p].f<r[d].f?p++:d++],r[h++]={s:-1,f:s.f+u.f,l:s,r:u};for(var f=o[0].s,n=1;n<a;++n)o[n].s>f&&(f=o[n].s);var m=new c(f+1),g=U(r[h-1],m,0);if(g>t){var n=0,v=0,y=g-t,b=1<<y;for(o.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});n<a;++n){var w=o[n].s;if(m[w]>t)v+=b-(1<<g-m[w]),m[w]=t;else break}for(v>>>=y;v>0;){var I=o[n].s;m[I]<t?v-=1<<t-m[I]++-1:++n}for(;n>=0&&v;--n){var E=o[n].s;m[E]==t&&(--m[E],++v)}g=t}return[new l(m),g]},U=function(e,t,r){return -1==e.s?Math.max(U(e.l,t,r+1),U(e.r,t,r+1)):t[e.s]=r},B=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new c(++t),n=0,a=e[0],o=1,i=function(e){r[n++]=e},s=1;s<=t;++s)if(e[s]==a&&s!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)i(32754);o>2&&(i(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(i(a),--o;o>6;o-=6)i(8304);o>2&&(i(o-3<<5|8208),o=0)}for(;o--;)i(a);o=1,a=e[s]}return[r.subarray(0,n),t]},z=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},G=function(e,t,r){var n=r.length,a=D(t+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var o=0;o<n;++o)e[a+o+4]=r[o];return(a+4+n)*8},V=function(e,t,r,n,a,o,i,s,l,u,f){S(t,f++,r),++a[256];for(var m,g,v,y,b=j(a,15),w=b[0],I=b[1],E=j(o,15),P=E[0],O=E[1],M=B(w),N=M[0],k=M[1],L=B(P),D=L[0],C=L[1],R=new c(19),U=0;U<N.length;++U)R[31&N[U]]++;for(var U=0;U<D.length;++U)R[31&D[U]]++;for(var V=j(R,7),X=V[0],_=V[1],H=19;H>4&&!X[d[H-1]];--H);var Y=u+5<<3,W=z(a,x)+z(o,A)+i,Z=z(a,w)+z(o,P)+i+14+3*H+z(R,X)+(2*R[16]+3*R[17]+7*R[18]);if(Y<=W&&Y<=Z)return G(t,f,e.subarray(l,l+u));if(S(t,f,1+(Z<W)),f+=2,Z<W){m=T(w,I,0),g=w,v=T(P,O,0),y=P;var K=T(X,_,0);S(t,f,k-257),S(t,f+5,C-1),S(t,f+10,H-4),f+=14;for(var U=0;U<H;++U)S(t,f+3*U,X[d[U]]);f+=3*H;for(var $=[N,D],q=0;q<2;++q)for(var Q=$[q],U=0;U<Q.length;++U){var J=31&Q[U];S(t,f,K[J]),f+=X[J],J>15&&(S(t,f,Q[U]>>>5&127),f+=Q[U]>>>12)}}else m=null,g=x,v=null,y=A;for(var U=0;U<s;++U)if(n[U]>255){var J=n[U]>>>18&31;F(t,f,m[J+257]),f+=g[J+257],J>7&&(S(t,f,n[U]>>>23&31),f+=p[J]);var ee=31&n[U];F(t,f,v[ee]),f+=y[ee],ee>3&&(F(t,f,n[U]>>>5&8191),f+=h[ee])}else F(t,f,m[n[U]]),f+=g[n[U]];return F(t,f,m[256]),f+g[256]},X=new u([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_=new l(0),H=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"},Y="undefined"!=typeof TextDecoder&&new TextDecoder;try{Y.decode(_,{stream:!0})}catch(e){}function W(e,t,r){let n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let a=e,o=n,i=Math.floor((a+o)/2);for(;t<r[i]||t>=r[i+1];)t<r[i]?o=i:a=i,i=Math.floor((a+o)/2);return i}class Z extends i.Hyl{constructor(e,t,r,n,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=a||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new i.Ltg(t.x,t.y,t.z,t.w)}}getPoint(e,t){let r=t||new i.Pa4,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(e,t,r,n){let a=W(e,n,t),o=function(e,t,r,n){let a=[],o=[],i=[];a[0]=1;for(let s=1;s<=r;++s){o[s]=t-n[e+1-s],i[s]=n[e+s]-t;let r=0;for(let e=0;e<s;++e){let t=i[e+1],n=o[s-e],l=a[e]/(t+n);a[e]=r+t*l,r=n*l}a[s]=r}return a}(a,n,e,t),s=new i.Ltg(0,0,0,0);for(let t=0;t<=e;++t){let n=r[a-e+t],i=o[t],l=n.w*i;s.x+=n.x*l,s.y+=n.y*l,s.z+=n.z*l,s.w+=n.w*i}return s}(this.degree,this.knots,this.controlPoints,n);return 1!=a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t){var r;let n=t||new i.Pa4,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=(r=this.degree,function(e){let t=e.length,r=[],n=[];for(let a=0;a<t;++a){let t=e[a];r[a]=new i.Pa4(t.x,t.y,t.z),n[a]=t.w}let a=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(a[e-r].clone().multiplyScalar(function(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}(e,r)*n[r]));a[e]=t.divideScalar(n[0])}return a}(function(e,t,r,n,a){let o=1<e?1:e,s=[],l=W(e,n,t),c=function(e,t,r,n,a){let o=[];for(let e=0;e<=r;++e)o[e]=0;let i=[];for(let e=0;e<=n;++e)i[e]=o.slice(0);let s=[];for(let e=0;e<=r;++e)s[e]=o.slice(0);s[0][0]=1;let l=o.slice(0),c=o.slice(0);for(let n=1;n<=r;++n){l[n]=t-a[e+1-n],c[n]=a[e+n]-t;let r=0;for(let e=0;e<n;++e){let t=c[e+1],a=l[n-e];s[n][e]=t+a;let o=s[e][n-1]/s[n][e];s[e][n]=r+t*o,r=a*o}s[n][n]=r}for(let e=0;e<=r;++e)i[0][e]=s[e][r];for(let e=0;e<=r;++e){let t=0,a=1,l=[];for(let e=0;e<=r;++e)l[e]=o.slice(0);l[0][0]=1;for(let o=1;o<=n;++o){let n=0,c=e-o,u=r-o;e>=o&&(l[a][0]=l[t][0]/s[u+1][c],n=l[a][0]*s[c][u]);let p=c>=-1?1:-c,h=e-1<=u?o-1:r-e;for(let e=p;e<=h;++e)l[a][e]=(l[t][e]-l[t][e-1])/s[u+1][c+e],n+=l[a][e]*s[c+e][u];e<=u&&(l[a][o]=-l[t][o-1]/s[u+1][e],n+=l[a][o]*s[e][u]),i[o][e]=n;let d=t;t=a,a=d}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)i[e][t]*=u;u*=r-e}return i}(l,n,e,o,t),u=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,u[e]=t}for(let t=0;t<=o;++t){let r=u[l-e].clone().multiplyScalar(c[t][0]);for(let n=1;n<=e;++n)r.add(u[l-e+n].clone().multiplyScalar(c[t][n]));s[t]=r}for(let e=o+1;e<=a+1;++e)s[e]=new i.Ltg(0,0,0);return s}(r,this.knots,this.controlPoints,a,1)));return n.copy(o[1]).normalize(),n}}function K(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}let $=parseInt(i.UZH.replace(/\D+/g,""))>=125?"uv1":"uv2";class q extends i.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,o=""===a.path?i.Zp0.extractUrlBase(e):a.path,s=new i.hH6(this.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r,o))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ef(e,0,t.length)}(e))n=new er().parse(e);else{let t=ef(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let n=0;n<t.length;++n)if(function(t){let n=e[0];return e=e.slice(r+1),r++,n}(0)===t[n])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>eo(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+eo(t));n=new et().parse(t)}return new Q(new i.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(n)}}class Q{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){a=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),i=new J().parse(n);return this.parseScene(n,i,r),o}parseConnections(){let e=new Map;return"Connections"in n&&n.Connections.connections.forEach(function(t){let r=t[0],n=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:n,relationship:a}),e.has(n)||e.set(n,{parents:[],children:[]}),e.get(n).children.push({ID:r,relationship:a})}),e}parseImages(){let e={},t={};if("Video"in n.Objects){let r=n.Objects.Video;for(let n in r){let a=r[n];if(e[parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){let e=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o="string"==typeof a.Content&&""!==a.Content;if(e||o){let e=this.parseImage(r[n]);t[a.RelativeFilename||a.Filename]=e}}}}for(let r in e){let n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t;let r=e.Content,n=e.RelativeFilename||e.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+a+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in n.Objects){let r=n.Objects.Texture;for(let n in r){let a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let n=e.WrapModeU,a=e.WrapModeV,o=void 0!==n?n.value:0,s=void 0!==a?a.value:0;if(r.wrapS=0===o?i.rpg:i.uWy,r.wrapT=0===s?i.rpg:i.uWy,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r,n;let o=this.textureLoader.path,s=a.get(e.id).children;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(0===(r=t[s[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let l=e.FileName.slice(-3).toLowerCase();if("tga"===l){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),n=new i.xEZ):(t.setPath(this.textureLoader.path),n=t.load(r))}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),n=new i.xEZ):n=this.textureLoader.load(r);return this.textureLoader.setPath(o),n}parseMaterials(e){let t=new Map;if("Material"in n.Objects){let r=n.Objects.Material;for(let n in r){let a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(e,t){let r;let n=e.id,o=e.attrName,s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!a.has(n))return null;let l=this.parseParameters(e,t,n);switch(s.toLowerCase()){case"phong":r=new i.xoR;break;case"lambert":r=new i.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),r=new i.xoR}return r.setValues(l),r.name=o,r}parseParameters(e,t,r){let n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new i.Ilk().fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(n.color=new i.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new i.Ilk().fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(n.emissive=new i.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new i.Ilk().fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=new i.Ilk().fromArray(e.SpecularColor.value));let o=this;return a.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":n.bumpMap=o.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=o.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=o.getTexture(t,e.ID),void 0!==n.map&&("colorSpace"in n.map?n.map.colorSpace="srgb":n.map.encoding=3001);break;case"DisplacementColor":n.displacementMap=o.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=o.getTexture(t,e.ID),void 0!==n.emissiveMap&&("colorSpace"in n.emissiveMap?n.emissiveMap.colorSpace="srgb":n.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=o.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=o.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=i.dSO,"colorSpace"in n.envMap?n.envMap.colorSpace="srgb":n.envMap.encoding=3001);break;case"SpecularColor":n.specularMap=o.getTexture(t,e.ID),void 0!==n.specularMap&&("colorSpace"in n.specularMap?n.specularMap.colorSpace="srgb":n.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=o.getTexture(t,e.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),n}getTexture(e,t){return"LayeredTexture"in n.Objects&&t in n.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=a.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in n.Objects){let r=n.Objects.Deformer;for(let n in r){let o=r[n],i=a.get(parseInt(n));if("Skin"===o.attrType){let t=this.parseSkeleton(i,r);t.ID=n,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=i.parents[0].ID,e[n]=t}else if("BlendShape"===o.attrType){let e={id:n};e.rawTargets=this.parseMorphTargets(i,r),e.id=n,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let n=t[e.ID];if("Cluster"!==n.attrType)return;let a={ID:e.ID,indices:[],weights:[],transformLink:new i.yGw().fromArray(n.TransformLink.a)};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),r.push(a)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let n=0;n<e.children.length;n++){let o=e.children[n],i=t[o.ID],s={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if("BlendShapeChannel"!==i.attrType)return;s.geoID=a.get(parseInt(o.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(s)}return r}parseScene(e,t,r){o=new i.ZAu;let s=this.parseModels(e.skeletons,t,r),l=n.Objects.Model,c=this;s.forEach(function(e){let t=l[e.ID];c.setLookAtProperties(e,t),a.get(e.ID).parents.forEach(function(t){let r=s.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&o.add(e)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),o.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=ep(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let u=new ee().parse();1===o.children.length&&o.children[0].isGroup&&(o.children[0].animations=u,o=o.children[0]),o.animations=u}parseModels(e,t,r){let o=new Map,s=n.Objects.Model;for(let n in s){let l=parseInt(n),c=s[n],u=a.get(l),p=this.buildSkeleton(u,e,l,c.attrName);if(!p){switch(c.attrType){case"Camera":p=this.createCamera(u);break;case"Light":p=this.createLight(u);break;case"Mesh":p=this.createMesh(u,t,r);break;case"NurbsCurve":p=this.createCurve(u,t);break;case"LimbNode":case"Root":p=new i.N$j;break;default:p=new i.ZAu}p.name=c.attrName?i.iUV.sanitizeNodeName(c.attrName):"",p.ID=l}this.getTransformData(p,c),o.set(l,p)}return o}buildSkeleton(e,t,r,n){let a=null;return e.parents.forEach(function(e){for(let o in t){let s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){let e=a;(a=new i.N$j).matrixWorld.copy(t.transformLink),a.name=n?i.iUV.sanitizeNodeName(n):"",a.ID=r,s.bones[o]=a,null!==e&&a.add(e)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new i.Tme;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let n=1;void 0!==r.NearPlane&&(n=r.NearPlane.value/1e3);let a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);let o=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(o=r.AspectWidth.value,s=r.AspectHeight.value);let l=o/s,c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);let u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new i.cPb(c,l,n,a),null!==u&&t.setFocalLength(u);break;case 1:t=new i.iKG(-o/2,o/2,s/2,-s/2,n,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new i.Tme}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new i.Tme;else{let e;e=void 0===r.LightType?0:r.LightType.value;let n=16777215;void 0!==r.Color&&(n=new i.Ilk().fromArray(r.Color.value));let a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);let o=0;switch(void 0!==r.FarAttenuationEnd&&(o=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new i.cek(n,a,o,1);break;case 1:t=new i.Ox3(n,a);break;case 2:let s=Math.PI/3;void 0!==r.InnerAngle&&(s=i.M8C.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=Math.max(l=i.M8C.degToRad(r.OuterAngle.value),1)),t=new i.PMe(n,a,o,s,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new i.cek(n,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let n;let a=null,o=null,s=[];return e.children.forEach(function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))}),s.length>1?o=s:s.length>0?o=s[0]:(o=new i.xoR({color:13421772}),s.push(o)),"color"in a.attributes&&s.forEach(function(e){e.vertexColors=!0}),a.FBX_Deformer?(n=new i.TUv(a,o)).normalizeSkinWeights():n=new i.Kj0(a,o),n}createCurve(e,t){let r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new i.nls({color:3342591,linewidth:1});return new i.x12(r,n)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=eh(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&a.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=n.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),o.add(e.target)):e.lookAt(new i.Pa4().fromArray(t))}}})}bindSkeleton(e,t,r){let n=this.parsePoseNodes();for(let o in e){let s=e[o];a.get(parseInt(s.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;a.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new i.OdW(s.bones),n[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in n.Objects){let t=n.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let n=t[r].PoseNode;Array.isArray(n)?n.forEach(function(t){e[t.Node]=new i.yGw().fromArray(t.Matrix.a)}):e[n.Node]=new i.yGw().fromArray(n.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in n&&"AmbientColor"in n.GlobalSettings){let e=n.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],a=e[2];if(0!==t||0!==r||0!==a){let e=new i.Ilk(t,r,a);o.add(new i.Mig(e,1))}}}}class J{parse(e){let t=new Map;if("Geometry"in n.Objects){let r=n.Objects.Geometry;for(let n in r){let o=a.get(parseInt(n)),i=this.parseGeometry(o,r[n],e);t.set(parseInt(n),i)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let a=r.skeletons,o=[],i=e.parents.map(function(e){return n.Objects.Model[e.ID]});if(0===i.length)return;let s=e.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&o.push(r.morphTargets[e.ID])});let l=i[0],c={};"RotationOrder"in l&&(c.eulerOrder=eh(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);let u=ep(c);return this.genGeometry(t,s,o,u)}genGeometry(e,t,r,n){let a=new i.u9r;e.attrName&&(a.name=e.attrName);let o=this.parseGeoNode(e,t),s=this.genBuffers(o),l=new i.a$l(s.vertex,3);if(l.applyMatrix4(n),a.setAttribute("position",l),s.colors.length>0&&a.setAttribute("color",new i.a$l(s.colors,3)),t&&(a.setAttribute("skinIndex",new i.qlB(s.weightsIndices,4)),a.setAttribute("skinWeight",new i.a$l(s.vertexWeights,4)),a.FBX_Deformer=t),s.normal.length>0){let e=new i.Vkp().getNormalMatrix(n),t=new i.a$l(s.normal,3);t.applyNormalMatrix(e),a.setAttribute("normal",t)}if(s.uvs.forEach(function(e,t){"uv2"===$&&t++;let r=0===t?"uv":`uv${t}`;a.setAttribute(r,new i.a$l(s.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach(function(r,n){r!==e&&(a.addGroup(t,n-t,e),e=r,t=n)}),a.groups.length>0){let t=a.groups[a.groups.length-1],r=t.start+t.count;r!==s.materialIndex.length&&a.addGroup(r,s.materialIndex.length-r,e)}0===a.groups.length&&a.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(a,e,r,n),a}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,a=!1,o=[],i=[],s=[],l=[],c=[],u=[],p=this;return e.vertexIndices.forEach(function(h,d){let f;let m=!1;h<0&&(h^=-1,m=!0);let g=[],v=[];if(o.push(3*h,3*h+1,3*h+2),e.color){let t=el(d,r,h,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach(function(e){v.push(e.weight),g.push(e.id)}),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);let e=[0,0,0,0],t=[0,0,0,0];v.forEach(function(r,n){let a=r,o=g[n];t.forEach(function(t,r,n){if(a>t){n[r]=a,a=t;let i=e[r];e[r]=o,o=i}})}),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){let t=el(d,r,h,e.normal);i.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=el(d,r,h,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){let n=el(d,r,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,m&&(p.genFace(t,e,o,f,i,s,l,c,u,n),r++,n=0,o=[],i=[],s=[],l=[],c=[],u=[])}),t}genFace(e,t,r,n,a,o,i,s,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(u-1)*3]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[(u-1)*4]),e.vertexWeights.push(s[(u-1)*4+1]),e.vertexWeights.push(s[(u-1)*4+2]),e.vertexWeights.push(s[(u-1)*4+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(u-1)*3]),e.colors.push(o[(u-1)*3+1]),e.colors.push(o[(u-1)*3+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(u-1)*3]),e.normal.push(a[(u-1)*3+1]),e.normal.push(a[(u-1)*3+2]),e.normal.push(a[3*u]),e.normal.push(a[3*u+1]),e.normal.push(a[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(i[r][0]),e.uvs[r].push(i[r][1]),e.uvs[r].push(i[r][(u-1)*2]),e.uvs[r].push(i[r][(u-1)*2+1]),e.uvs[r].push(i[r][2*u]),e.uvs[r].push(i[r][2*u+1])})}addMorphTargets(e,t,r,a){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let o=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let i=n.Objects.Geometry[r.geoID];void 0!==i&&o.genMorphGeometry(e,t,i,a,r.name)})})}genMorphGeometry(e,t,r,n,a){let o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=new Float32Array(3*e.attributes.position.count);for(let e=0;e<l.length;e++){let t=3*l[e];c[t]=s[3*e],c[t+1]=s[3*e+1],c[t+2]=s[3*e+2]}let u=this.genBuffers({vertexIndices:o,vertexPositions:c}),p=new i.a$l(u.vertex,3);p.name=a||r.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,a=[];return"IndexToDirect"===r&&(a=e.ColorIndex.a),{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let n=e.Materials.a,a=[];for(let e=0;e<n.length;++e)a.push(e);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;if(void 0===Z)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.u9r;let n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.u9r;let a=n-1,o=e.KnotVector.a,s=[],l=e.Points.a;for(let e=0,t=l.length;e<t;e+=4)s.push(new i.Ltg().fromArray(l,e));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){t=a,r=o.length-1-t;for(let e=0;e<a;++e)s.push(s[e])}let c=new Z(a,o,s,t,r).getPoints(12*s.length);return new i.u9r().setFromPoints(c)}}class ee{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let n=t[r],a=this.addClip(n);e.push(a)}return e}parseClips(){if(void 0===n.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=n.Objects.AnimationCurveNode,t=new Map;for(let r in e){let n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){let e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=n.Objects.AnimationCurve;for(let r in t){let n={id:t[r].id,times:t[r].KeyTime.a.map(ei),values:t[r].KeyValueFloat.a},o=a.get(n.id);if(void 0!==o){let t=o.parents[0].ID,r=o.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){let t=n.Objects.AnimationLayer,r=new Map;for(let s in t){let t=[],l=a.get(parseInt(s));void 0!==l&&(l.children.forEach(function(r,s){if(e.has(r.ID)){let l=e.get(r.ID);if(void 0!==l.curves.x||void 0!==l.curves.y||void 0!==l.curves.z){if(void 0===t[s]){let e=a.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let a=n.Objects.Model[e.toString()];if(void 0===a){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}let l={modelName:a.attrName?i.iUV.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};o.traverse(function(e){e.ID===a.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))}),l.transform||(l.transform=new i.yGw),"PreRotation"in a&&(l.preRotation=a.PreRotation.value),"PostRotation"in a&&(l.postRotation=a.PostRotation.value),t[s]=l}}t[s]&&(t[s][l.attr]=l)}else if(void 0!==l.curves.morph){if(void 0===t[s]){let e=a.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,o=a.get(e).parents[0].ID,l=a.get(o).parents[0].ID,c=a.get(l).parents[0].ID,u=n.Objects.Model[c],p={modelName:u.attrName?i.iUV.sanitizeNodeName(u.attrName):"",morphName:n.Objects.Deformer[e].attrName};t[s]=p}t[s][l.attr]=l}}}),r.set(parseInt(s),t))}return r}parseAnimStacks(e){let t=n.Objects.AnimationStack,r={};for(let n in t){let o=a.get(parseInt(n)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let i=e.get(o[0].ID);r[n]={name:t[n].attrName,layer:i}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new i.m7l(e.name,-1,t)}generateTracks(e){let t=[],r=new i.Pa4,n=new i._fP,a=new i.Pa4;if(e.transform&&e.transform.decompose(r,n,a),r=r.toArray(),n=new i.USm().setFromQuaternion(n,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,n){let a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,r);return new i.yC1(e+"."+n,a,o)}generateRotationTrack(e,t,r,n,a,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(i.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(i.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(i.M8C.degToRad));let s=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(s,t,r);void 0!==n&&((n=n.map(i.M8C.degToRad)).push(o),n=new i.USm().fromArray(n),n=new i._fP().setFromEuler(n)),void 0!==a&&((a=a.map(i.M8C.degToRad)).push(o),a=new i.USm().fromArray(a),a=new i._fP().setFromEuler(a).invert());let c=new i._fP,u=new i.USm,p=[];for(let e=0;e<l.length;e+=3)u.set(l[e],l[e+1],l[e+2],o),c.setFromEuler(u),void 0!==n&&c.premultiply(n),void 0!==a&&c.multiply(a),c.toArray(p,e/3*4);return new i.iLg(e+".quaternion",s,p)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),n=o.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.dUE(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){let a=t[n];a!==r&&(t[e]=a,r=a,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let n=[],a=-1,o=-1,i=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(i=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];n.push(e),r[0]=e}else n.push(r[0]);if(-1!==o){let e=t.y.values[o];n.push(e),r[1]=e}else n.push(r[1]);if(-1!==i){let e=t.z.values[i];n.push(e),r[2]=e}else n.push(r[2])}),n}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],n=e.values[t]-r,a=Math.abs(n);if(a>=180){let o=a/180,i=n/o,s=r+i,l=e.times[t-1],c=(e.times[t]-l)/o,u=l+c,p=[],h=[];for(;u<e.times[t];)p.push(u),u+=c,h.push(s),s+=i;e.times=em(e.times,t,p),e.values=em(e.values,t,h)}}}}class et{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new ea,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){let a=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(a||o)return;let i=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");i?t.parseNodeBegin(e,i):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},o=this.parseNodeAttr(n),i=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in i?("PoseNode"===r?i.PoseNode.push(a):void 0!==i[r].id&&(i[r]={},i[r][i[r].id]=i[r]),""!==o.id&&(i[r][o.id]=a)):"number"==typeof o.id?(i[r]={},i[r][o.id]=a):"Properties70"!==r&&("PoseNode"===r?i[r]=[a]:i[r]=a),"number"==typeof o.id&&(a.id=o.id),""!==o.name&&(a.attrName=o.name),""!==o.type&&(a.attrType=o.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());let o=this.getCurrentNode();if("Properties70"===o.name){this.parseNodeSpecialProperty(e,n,a);return}if("C"===n){let e=a.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),i=a.split(",").slice(3);i=i.map(function(e){return e.trim().replace(/^"/,"")}),n="connections",function(e,t){for(let r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a=[t,r],i),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=a),n in o&&Array.isArray(o[n])?o[n].push(a):"a"!==n?o[n]=a:o.a=a,this.setCurrentProp(o,n),"a"===n&&","!==a.slice(-1)&&(o.a=ed(a))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ed(t.a))}parseNodeSpecialProperty(e,t,r){let n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=n[0],o=n[1],i=n[2],s=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=ed(l)}this.getPrevNode()[a]={type:o,type2:i,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),a)}}class er{parse(e){let t=new en(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let n=new ea;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let o=e.getUint8(),i=e.getString(o);if(0===n)return null;let s=[];for(let t=0;t<a;t++)s.push(this.parseProperty(e));let l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){let n=this.parseNode(e,t);null!==n&&this.parseSubNode(i,r,n)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==i&&(r.name=i),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,n=r.propertyList[0],a=r.propertyList[1],o=r.propertyList[2],i=r.propertyList[3];0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),e="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[n]={type:a,type2:o,flag:i,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t;let r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n;let a=e.getUint32(),o=e.getUint32(),i=e.getUint32();if(0===o)switch(r){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}let s=new en(R((H(n=new Uint8Array(e.getArrayBuffer(i))),n.subarray(2,-4)),void 0).buffer);switch(r){case"b":case"c":return s.getBooleanArray(a);case"d":return s.getFloat64Array(a);case"f":return s.getFloat32Array(a);case"i":return s.getInt32Array(a);case"l":return s.getInt64Array(a)}default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class en{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t)?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();let r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),K(new Uint8Array(t))}}class ea{add(e,t){this[e]=t}}function eo(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ei(e){return e/46186158e3}let es=[];function el(e,t,r,n){let a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);let o=a*n.dataSize,i=o+n.dataSize;return function(e,t,r,n){for(let a=r,o=0;a<n;a++,o++)e[o]=t[a];return e}(es,n.buffer,o,i)}let ec=new i.USm,eu=new i.Pa4;function ep(e){let t=new i.yGw,r=new i.yGw,n=new i.yGw,a=new i.yGw,o=new i.yGw,s=new i.yGw,l=new i.yGw,c=new i.yGw,u=new i.yGw,p=new i.yGw,h=new i.yGw,d=new i.yGw,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(eu.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(i.M8C.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(ec.fromArray(t))}if(e.rotation){let t=e.rotation.map(i.M8C.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(ec.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(i.M8C.degToRad);t.push(e.eulerOrder),a.makeRotationFromEuler(ec.fromArray(t)),a.invert()}e.scale&&o.scale(eu.fromArray(e.scale)),e.scalingOffset&&l.setPosition(eu.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(eu.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(eu.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(eu.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),p.copy(e.parentMatrixWorld));let m=r.clone().multiply(n).multiply(a),g=new i.yGw;g.extractRotation(p);let v=new i.yGw;v.copyPosition(p);let y=v.clone().invert().multiply(p),b=g.clone().invert().multiply(y),w=new i.yGw;if(0===f)w.copy(g).multiply(m).multiply(b).multiply(o);else if(1===f)w.copy(g).multiply(b).multiply(m).multiply(o);else{let e=new i.yGw().scale(new i.Pa4().setFromMatrixScale(h)).clone().invert(),t=b.clone().multiply(e);w.copy(g).multiply(m).multiply(t).multiply(o)}let I=u.clone().invert(),E=s.clone().invert(),P=t.clone().multiply(c).multiply(u).multiply(r).multiply(n).multiply(a).multiply(I).multiply(l).multiply(s).multiply(o).multiply(E),T=new i.yGw().copyPosition(P),x=p.clone().multiply(T);return d.copyPosition(x),(P=d.clone().multiply(w)).premultiply(p.invert()),P}function eh(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function ed(e){return e.split(",").map(function(e){return parseFloat(e)})}function ef(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),K(new Uint8Array(e,t,r))}function em(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}}}]);